---
title: "Base GARCH Model Comparision"
author: "Colburn Hassman"
date: "11/17/2020"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tseries)
library(xts)
library(tidyverse)
library(fpp2)
library(stats)
library(rugarch)
setwd("~/Documents/etf_tracking")

```

```{r data_import, include = FALSE, echo=FALSE, warning=FALSE}

#-----------------Import Data from Excel and order------------#
CORN <- read.csv("~/Documents/etf_tracking/corn.csv")
SOYB <- read.csv("~/Documents/etf_tracking/soyb.csv")
WEAT <- read.csv("~/Documents/etf_tracking/weat.csv")
USO <- read.csv("~/Documents/etf_tracking/uso.csv")
UGA <- read.csv("~/Documents/etf_tracking/uga.csv")



#------------------Date Manipulation and Cleaning---------------#

# When importing data from csv, for some reason empty columns are created
# This is only a temporary solution to this problem
CORN <- CORN[1:(length(CORN)-2)]
SOYB <- SOYB[1:(length(SOYB)-1)]
WEAT <- WEAT[1:(length(WEAT)-2)]
# USO Good
UGA <- UGA[1:(length(UGA)-1)]




CORN$DATE <- as.Date(CORN$DATE, format = "%m/%d/%Y")  #set date 
CORN <- CORN[order(CORN$DATE),] #order by date
CORN$asset_basket <- (CORN$`F1..35.` * 0.35) + (CORN$`F2..3.` * 0.3) + (CORN$`F3..35.` * 0.35) #reconstruct asset basket
CORN$per_asset_return <- log(CORN$asset_basket/lag(CORN$asset_basket))* 100 # calculate percent asset basket return
CORN$per_ETF_return <- log(CORN$CORN_MID/lag(CORN$CORN_MID)) * 100#calculate percent ETF return


SOYB$DATE <- as.Date(SOYB$DATE, format = "%m/%d/%Y") # Set date
SOYB <- SOYB[order(SOYB$DATE),] #order by date
SOYB$asset_basket <- (SOYB$`F1..35.` * 0.35) + (SOYB$`F2..3.` * 0.30) + (SOYB$`F3..35.` * 0.35)
SOYB$per_asset_return <- log(SOYB$asset_basket / lag(SOYB$asset_basket)) * 100
SOYB$per_ETF_return <- log(SOYB$SOYB_MID / lag(SOYB$SOYB_MID)) * 100


WEAT$DATE <- as.Date(WEAT$DATE, format = "%m/%d/%Y") #set date 
WEAT <- WEAT[order(WEAT$DATE),] #order by date
WEAT$asset_basket <- (WEAT$`F1..35.` * 0.35) + (WEAT$`F2..3.` * 0.3) + (WEAT$`F3..35.` * 0.35) #reconstruct asset basket
WEAT$per_asset_return <- log(WEAT$asset_basket/lag(WEAT$asset_basket))* 100 # calculate percent asset basket return
WEAT$per_ETF_return <- log(WEAT$WEAT_MID/lag(WEAT$WEAT_MID)) * 100#calculate percent ETF return


USO$DATE <- as.Date(USO$DATE, format = "%m/%d/%Y")
USO <- USO[order(USO$DATE),]
USO$per_asset_return <- log(USO$Futures/lag(USO$Futures)) * 100
USO$per_ETF_return <- log(USO$USO_MID /lag(USO$USO_MID)) * 100

UGA$DATE <- as.Date(UGA$DATE, format = "%m/%d/%Y")
UGA <- UGA[order(UGA$DATE),]
UGA$per_asset_return <- log(UGA$Futures/lag(UGA$Futures)) * 100
UGA$per_ETF_return <- log(UGA$UGA_MID/lag(UGA$UGA_MID)) * 100



#--- More data cleaning
# The code below handles the issue of roll dates 
CORN <- na.omit(CORN)  
CORN <- CORN[!(CORN$ROLL == 1),] #directly remove roll
CORN.xts <- xts(CORN[,-1], order.by = CORN$DATE)

SOYB <- na.omit(SOYB)
SOYB <- SOYB[!(SOYB$ROLL == 1),]
SOYB.xts <- xts(SOYB[,-1], order.by = SOYB$DATE) #create xts object

WEAT <- na.omit(WEAT) 
WEAT <- WEAT[!(WEAT$ROLL == 1),]
WEAT.xts <- xts(WEAT[,-1], order.by = WEAT$DATE)


USO <- na.omit(USO)
USO <- USO[!(USO$ROLL == 1),]
USO.xts <- as.xts(USO, order.by = USO$DATE)

UGA <- na.omit(UGA) 
UGA <- UGA[!(UGA$ROLL == 1),]
UGA.xts <- xts(UGA[,-1], order.by = UGA$DATE)

```

# Introduction

The goal of this document is to describe the thought process behind the base GARCH model specification. Information about the data and the calculation of returns can be found in the data section of the draft. I will not review that, instead beginning with the OLS results. Just to remind of the ols specification:

$$ R^e_{t} = \alpha + \beta R^a_{t} + \epsilon_{t} $$

where $R^e$ is the return of the etf and $R^a$ is the return of the asset. We define *tracking error* thus as $\epsilon_{t}$.

For each ETF I employ the following methology for fitting a base mode. I will go one-by-one through each ETF investigating the tracking error ($\epsilon_{t}$). 

1. Test for ARCH effects by analysing the autocorrelation of the squared tracking error
2. Test for inclusion of unconditional mean in GARCH specification
3. Test for inclusion of ARCH in mean in GARCH specification
4. Consider asymmetric specifications
5. Consider student-t distribution rather than normal
6. Reconsider asymmetric specification with student-t distribution
7. Fit ARMA process using Box-Jenkins Procedure
8. Repeat steps 2:6 including an ARMA process in the model specification
9. Summarize my findings. 

Below are the summaries for each ETF. What follows after is the full process for each ETF. 

**CORN Summary**

We find that include ARCH in mean or the unconditional mean does not improve model fit. The assumed distribution is important: the student t distribution is a much better fit than the normal. Regardless of distribution, asymmetric model specifications do not improve model fit. Fitting an ARMA process (in this case an MA1 process) greatly improves model fit.

**SOYB Summary**

As with CORN, it is likely best to not include ARCH in mean or the unconditional mean in this model specification. Model fit was greatly improved by fitting an ARMA(2,3) process and further greatly improved by using a student-t distribution. Unlike CORN, some of the Asymmetric specifications did have a better fit. 

**WEAT Summary**

As with CORN and SOYB, it is likely best to not include ARCH in mean or the unconditional mean in this model specification as it does not improve model fit or produce significant coefficients. Fitting an ARMA (1,5) process also improved fit significantly. Changing from a normal distribution to a student t distribution *slightly* improved model fit. Asymmetric models did not have better fit. 

\newpage
## Corn

```{r corn_setup, echo = FALSE}
x <- CORN
```

Lets begin by looking at the OLS results for CORN. We would reject both of our null hypothesis ($\alpha = 0$ and $\beta = 1$)

```{r corn_ols, echo = FALSE}
ols <- lm(x$per_ETF_return ~ x$per_asset_return)
summary(ols)
x$etf_asset_error <- ols$residuals
```

Now we investigate the residuals. There is clearly evidence of ARCH effects in the residuals based off the Ljung-Box Test.

```{r corn_arch, echo = FALSE}
tsdisplay(ols$residuals)

tsdisplay(ols$residuals^2)

Box.test(ols$residuals^2, type = "Ljung-Box")
```
Now a base model without an ARMA process. The simplist GARCH(1,1) model where we do not include the unconditional mean would be produce these robust coefficients
```{r corn_1, echo = FALSE}
base.1.spec <- ugarchspec(variance.model = list(garchOrder = c(1,1)),
                          mean.model = list(armaOrder = c(0,0), include.mean = FALSE))
base.1.fit <- ugarchfit(data = x$etf_asset_error, spec = base.1.spec, solver = 'hybrid')

"No unconditional mean Robust Coefficients"
base.1.fit@fit[['robust.matcoef']]
infocriteria(base.1.fit)

```

Including the unconditional mean does not improve model fit. 

```{r corn_2, echo=FALSE}
base.1.spec <- ugarchspec(variance.model = list(garchOrder = c(1,1)),
                          mean.model = list(armaOrder = c(0,0), include.mean = TRUE))
base.1.fit <- ugarchfit(data = x$etf_asset_error, spec = base.1.spec, solver = 'hybrid')

"Including Unconditional Mean Robust Coefficients"
base.1.fit@fit[['robust.matcoef']]
infocriteria(base.1.fit)
```
We can now investigate an ARCH in means. The coefficient estimate for archm is statistically insignificant and inclusion does not improve model fit. 

```{r corn_3, echo = FALSE}

base.1.spec <- ugarchspec(variance.model = list(garchOrder = c(1,1)),
                          mean.model = list(armaOrder = c(0,0), include.mean = TRUE, 
                                            archm = TRUE ))
base.1.fit <- ugarchfit(data = x$etf_asset_error, spec = base.1.spec, solver = 'hybrid')

"Robust Coefficients"
base.1.fit@fit[['robust.matcoef']]
infocriteria(base.1.fit)

```

Currently the best model does not include the unconditional mean or arch in mean. While we have this very basic models, lets try some other flavors or GARCH to see if there are any large difference. 

```{r corn_4, echo = FALSE}

base.1.spec <- ugarchspec(variance.model = list(garchOrder = c(1,1), model = "apARCH"),
                          mean.model = list(armaOrder = c(0,0), include.mean = TRUE, 
                                            archm = FALSE ))
base.1.fit <- ugarchfit(data = x$etf_asset_error, spec = base.1.spec, solver = 'hybrid')
"Asymmetric Power ARCH (apARCH) Robust Coefficients"
base.1.fit@fit[['robust.matcoef']]
infocriteria(base.1.fit)


base.1.spec <- ugarchspec(variance.model = list(garchOrder = c(1,1), model = 'gjrGARCH'),
                          mean.model = list(armaOrder = c(0,0), include.mean = TRUE, 
                                            archm = FALSE ))
base.1.fit <- ugarchfit(data = x$etf_asset_error, spec = base.1.spec, solver = 'hybrid')

"GJR ARCH Robust Coefficients"
base.1.fit@fit[['robust.matcoef']]
infocriteria(base.1.fit)


base.1.spec <- ugarchspec(variance.model = list(garchOrder = c(1,1), model = 'eGARCH'),
                          mean.model = list(armaOrder = c(0,0), include.mean = TRUE, 
                                            archm = FALSE ))
base.1.fit <- ugarchfit(data = x$etf_asset_error, spec = base.1.spec, solver = 'hybrid')
"eARCH Robust Coefficients"
base.1.fit@fit[['robust.matcoef']]
infocriteria(base.1.fit)

```

No asymmetric model we have tested has a better fit than the base. We may also try some different distributions. Ramos 2015 used a student-t distribution which introduces a new coefficient *skew*

```{r corn_5, echo=FALSE}
base.1.spec <- ugarchspec(variance.model = list(garchOrder = c(1,1), model = 'sGARCH'),
                          mean.model = list(armaOrder = c(0,0), include.mean = FALSE),                                                  distribution.model = 'std')
base.1.fit <- ugarchfit(data = x$etf_asset_error, spec = base.1.spec, solver = 'hybrid')

"Base Robust Coefficients"
base.1.fit@fit[['robust.matcoef']]
infocriteria(base.1.fit)


base.1.spec <- ugarchspec(variance.model = list(garchOrder = c(1,1), model = "apARCH"),
                          mean.model = list(armaOrder = c(0,0), include.mean = TRUE, 
                                            archm = FALSE ), distribution.model = 'std')
base.1.fit <- ugarchfit(data = x$etf_asset_error, spec = base.1.spec, solver = 'hybrid')
"Asymmetric Power ARCH (apARCH) Robust Coefficients"
base.1.fit@fit[['robust.matcoef']]
infocriteria(base.1.fit)


base.1.spec <- ugarchspec(variance.model = list(garchOrder = c(1,1), model = "gjrGARCH"),
                          mean.model = list(armaOrder = c(0,0), include.mean = TRUE, 
                                            archm = FALSE ), distribution.model = 'std')
base.1.fit <- ugarchfit(data = x$etf_asset_error, spec = base.1.spec, solver = 'hybrid')

"GJR ARCH Robust Coefficients"
base.1.fit@fit[['robust.matcoef']]
infocriteria(base.1.fit)


base.1.spec <- ugarchspec(variance.model = list(garchOrder = c(1,1), model = "eGARCH"),
                          mean.model = list(armaOrder = c(0,0), include.mean = TRUE, 
                                            archm = FALSE ), distribution.model = 'std')
base.1.fit <- ugarchfit(data = x$etf_asset_error, spec = base.1.spec, solver = 'hybrid')
"eARCH Robust Coefficients"
base.1.fit@fit[['robust.matcoef']]
infocriteria(base.1.fit)

```

Using a student-t distribution significantly improves model fit. Within the models we test, the base, non asymmetric model still has the best fit. 

Now lets start over and fit an ARMA process to the residuals. I utilize the Box- Jenkins procedure to fit the model. A good specification would have no autocorrelation in the residuals, but autocorrelation in the squared residuals.

The autocorrelation of the residuals is significant, but dies off very slowly. With a max lag of 10, an ARMA(0,1) model has the characteristics we are searching for. 

```{r corn_arma1, echo=FALSE}
checkresiduals(x$etf_asset_error)

a <- arima(x$etf_asset_error, c(0,0,1))
Box.test(a$residuals, lag = 10, type = 'Ljung-Box')
Box.test(a$residuals^2, lag = 10, type = 'Ljung-Box')
```


Now let's start over from the beginning with out base GARCH model and see if we should include the unconditional mean. Immediately huge improvements in model fit by including an MA process. The fit does not improve when including the unconditional mean, so I will leave it out. 


```{r corn_arma2, echo=FALSE}
base.1.spec <- ugarchspec(variance.model = list(garchOrder = c(1,1)),
                          mean.model = list(armaOrder = c(0,1), include.mean = FALSE))
base.1.fit <- ugarchfit(data = x$etf_asset_error, spec = base.1.spec, solver = 'hybrid')

"No Unconditional Mean Robust Coefficients"
base.1.fit@fit[['robust.matcoef']]
infocriteria(base.1.fit)

base.1.spec <- ugarchspec(variance.model = list(garchOrder = c(1,1)),
                          mean.model = list(armaOrder = c(0,1), include.mean = TRUE))
base.1.fit <- ugarchfit(data = x$etf_asset_error, spec = base.1.spec, solver = 'hybrid')

"Including Unconditional Mean Robust Coefficients"
base.1.fit@fit[['robust.matcoef']]
infocriteria(base.1.fit)
```

As in the non ARMA specification, the archm coefficient is not statistically significant and its inclusion does not help model fit. 

```{r corn_arma3, echo = FALSE}
base.1.spec <- ugarchspec(variance.model = list(garchOrder = c(1,1)),
                          mean.model = list(armaOrder = c(0,1), include.mean = FALSE))
base.1.fit <- ugarchfit(data = x$etf_asset_error, spec = base.1.spec, solver = 'hybrid')

"No ARCH in Mean Robust Coefficients"
base.1.fit@fit[['robust.matcoef']]
infocriteria(base.1.fit)


base.1.spec <- ugarchspec(variance.model = list(garchOrder = c(1,1)),
                          mean.model = list(armaOrder = c(0,1), include.mean = FALSE, 
                                            archm = TRUE))
base.1.fit <- ugarchfit(data = x$etf_asset_error, spec = base.1.spec, solver = 'hybrid')

"ARCH in Mean Robust Coefficients"
base.1.fit@fit[['robust.matcoef']]
infocriteria(base.1.fit)
```

Now lets compare normal distribution with student-t. Again we find student-t distribution to have a much better fit. 

```{r corn_arma4, echo=FALSE}
base.1.spec <- ugarchspec(variance.model = list(garchOrder = c(1,1)),
                          mean.model = list(armaOrder = c(0,1), include.mean = FALSE),
                          distribution.model = 'norm')
base.1.fit <- ugarchfit(data = x$etf_asset_error, spec = base.1.spec, solver = 'hybrid')

"Normal Distribution Robust Coefficients"
base.1.fit@fit[['robust.matcoef']]
infocriteria(base.1.fit)

base.1.spec <- ugarchspec(variance.model = list(garchOrder = c(1,1)),
                          mean.model = list(armaOrder = c(0,1), include.mean = FALSE),
                          distribution.model = 'std')
base.1.fit <- ugarchfit(data = x$etf_asset_error, spec = base.1.spec, solver = 'hybrid')

"Student t Distribution Robust Coefficients"
base.1.fit@fit[['robust.matcoef']]
infocriteria(base.1.fit)
```

As we saw with the GARCH process with an ARMA process, asymmetric model specifications do not improve model fit


```{r corn_arma5, echo=FALSE}
base.1.spec <- ugarchspec(variance.model = list(garchOrder = c(1,1)),
                          mean.model = list(armaOrder = c(0,1), include.mean = FALSE),
                          distribution.model = 'std')
base.1.fit <- ugarchfit(data = x$etf_asset_error, spec = base.1.spec, solver = 'hybrid')

"Standard GARCH Robust Coefficients"
base.1.fit@fit[['robust.matcoef']]
infocriteria(base.1.fit)



base.1.spec <- ugarchspec(variance.model = list(garchOrder = c(1,1), model = "apARCH"),
                          mean.model = list(armaOrder = c(0,1), include.mean = FALSE),
                          distribution.model = 'std')
base.1.fit <- ugarchfit(data = x$etf_asset_error, spec = base.1.spec, solver = 'hybrid')

"Asymmetric Power GARCH (apGARCH) Robust Coefficients"
base.1.fit@fit[['robust.matcoef']]
infocriteria(base.1.fit)

base.1.spec <- ugarchspec(variance.model = list(garchOrder = c(1,1), model = "gjrGARCH"),
                          mean.model = list(armaOrder = c(0,1), include.mean = FALSE),
                          distribution.model = 'std')
base.1.fit <- ugarchfit(data = x$etf_asset_error, spec = base.1.spec, solver = 'hybrid')

"GJR GARCH Robust Coefficients"
base.1.fit@fit[['robust.matcoef']]
infocriteria(base.1.fit)

base.1.spec <- ugarchspec(variance.model = list(garchOrder = c(1,1), model = "eGARCH"),
                          mean.model = list(armaOrder = c(0,1), include.mean = FALSE),
                          distribution.model = 'std')
base.1.fit <- ugarchfit(data = x$etf_asset_error, spec = base.1.spec, solver = 'hybrid')

"Exponential Power GARCH Robust Coefficients"
base.1.fit@fit[['robust.matcoef']]
infocriteria(base.1.fit)

```


### CORN Summary

We find that include ARCH in mean or the unconditional mean does not improve model fit. The assumed distribution is important: the student t distribution is a much better fit than the normal. Regardless of distribution, asymmetric model specifications do not improve model fit. Fitting an ARMA process (in this case an MA1 process) greatly improves model fit.


\newpage

## Soybeans

```{r soyb_setup, echo = FALSE}
x <- SOYB
```

Lets begin by looking at the OLS results for soybeans. Unlike CORN, we fail to reject both of our null hypothesis ($\alpha = 0$ and $\beta = 1$). 

```{r soyb_ols, echo = FALSE}
ols <- lm(x$per_ETF_return ~ x$per_asset_return)
summary(ols)
x$etf_asset_error <- ols$residuals
```

Just like CORN, there evidence of ARCH effects in the residuals based off the Ljung-Box Test.

```{r soyb_arch, echo = FALSE}
tsdisplay(ols$residuals)

tsdisplay(ols$residuals^2)

Box.test(ols$residuals^2, type = "Ljung-Box")
```

Including the unconditional mean is unimformative.

```{r soyb_1, echo = FALSE}
base.1.spec <- ugarchspec(variance.model = list(garchOrder = c(1,1)),
                          mean.model = list(armaOrder = c(0,0), include.mean = FALSE))
base.1.fit <- ugarchfit(data = x$etf_asset_error, spec = base.1.spec, solver = 'hybrid')

"No unconditional mean Robust Coefficients"
base.1.fit@fit[['robust.matcoef']]
infocriteria(base.1.fit)

base.1.spec <- ugarchspec(variance.model = list(garchOrder = c(1,1)),
                          mean.model = list(armaOrder = c(0,0), include.mean = TRUE))
base.1.fit <- ugarchfit(data = x$etf_asset_error, spec = base.1.spec, solver = 'hybrid')

"Including Unconditional Mean Robust Coefficients"
base.1.fit@fit[['robust.matcoef']]
infocriteria(base.1.fit)
```

The ARCH in mean coefficient is not statistically significant at the 5% level, and including it does not help model fit. 

```{r soyb_3, echo = FALSE}

base.1.spec <- ugarchspec(variance.model = list(garchOrder = c(1,1)),
                          mean.model = list(armaOrder = c(0,0), include.mean = TRUE, 
                                            archm = TRUE ))
base.1.fit <- ugarchfit(data = x$etf_asset_error, spec = base.1.spec, solver = 'hybrid')

"ARCH in Mean Robust Coefficients"
base.1.fit@fit[['robust.matcoef']]
infocriteria(base.1.fit)

```

As with CORN, lets compare different asymmetric specifications, still assuming a normal distribution. I find not reason to move to an asymmetric model.

```{r soyb_4, echo = FALSE}

base.1.spec <- ugarchspec(variance.model = list(garchOrder = c(1,1)),
                          mean.model = list(armaOrder = c(0,0), include.mean = FALSE))
base.1.fit <- ugarchfit(data = x$etf_asset_error, spec = base.1.spec, solver = 'hybrid')

"Standard GARCH Robust Coefficients"
base.1.fit@fit[['robust.matcoef']]
infocriteria(base.1.fit)


base.1.spec <- ugarchspec(variance.model = list(garchOrder = c(1,1), model = "apARCH"),
                          mean.model = list(armaOrder = c(0,0), include.mean = TRUE, 
                                            archm = FALSE ))
base.1.fit <- ugarchfit(data = x$etf_asset_error, spec = base.1.spec, solver = 'hybrid')
"Asymmetric Power ARCH (apARCH) Robust Coefficients"
base.1.fit@fit[['robust.matcoef']]
infocriteria(base.1.fit)


base.1.spec <- ugarchspec(variance.model = list(garchOrder = c(1,1), model = 'gjrGARCH'),
                          mean.model = list(armaOrder = c(0,0), include.mean = TRUE, 
                                            archm = FALSE ))
base.1.fit <- ugarchfit(data = x$etf_asset_error, spec = base.1.spec, solver = 'hybrid')

"GJR ARCH Robust Coefficients"
base.1.fit@fit[['robust.matcoef']]
infocriteria(base.1.fit)


base.1.spec <- ugarchspec(variance.model = list(garchOrder = c(1,1), model = 'eGARCH'),
                          mean.model = list(armaOrder = c(0,0), include.mean = TRUE, 
                                            archm = FALSE ))
base.1.fit <- ugarchfit(data = x$etf_asset_error, spec = base.1.spec, solver = 'hybrid')
"eARCH Robust Coefficients"
base.1.fit@fit[['robust.matcoef']]
infocriteria(base.1.fit)

```

Again, I will replace the normal distribution with the student t distribution. Model fit improves significantly. Notably, an two asymmetric models: the asymmetric power ARCH and GJR ARCH have better fits than the standard model. 

```{r soyb_5, echo=FALSE}
base.1.spec <- ugarchspec(variance.model = list(garchOrder = c(1,1), model = 'sGARCH'),
                          mean.model = list(armaOrder = c(0,0), include.mean = FALSE),                                                         distribution.model = 'std')
base.1.fit <- ugarchfit(data = x$etf_asset_error, spec = base.1.spec, solver = 'hybrid')

"Standard GARCH Robust Coefficients"
base.1.fit@fit[['robust.matcoef']]
infocriteria(base.1.fit)


base.1.spec <- ugarchspec(variance.model = list(garchOrder = c(1,1), model = "apARCH"),
                          mean.model = list(armaOrder = c(0,0), include.mean = FALSE, 
                                            archm = FALSE ), distribution.model = 'std')
base.1.fit <- ugarchfit(data = x$etf_asset_error, spec = base.1.spec, solver = 'hybrid')
"Asymmetric Power ARCH (apARCH) Robust Coefficients"
base.1.fit@fit[['robust.matcoef']]
infocriteria(base.1.fit)


base.1.spec <- ugarchspec(variance.model = list(garchOrder = c(1,1), model = "gjrGARCH"),
                          mean.model = list(armaOrder = c(0,0), include.mean = FALSE, 
                                            archm = FALSE ), distribution.model = 'std')
base.1.fit <- ugarchfit(data = x$etf_asset_error, spec = base.1.spec, solver = 'hybrid')

"GJR ARCH Robust Coefficients"
base.1.fit@fit[['robust.matcoef']]
infocriteria(base.1.fit)


base.1.spec <- ugarchspec(variance.model = list(garchOrder = c(1,1), model = "eGARCH"),
                          mean.model = list(armaOrder = c(0,0), include.mean = FALSE, 
                                            archm = FALSE ), distribution.model = 'std')
base.1.fit <- ugarchfit(data = x$etf_asset_error, spec = base.1.spec, solver = 'hybrid')
"eARCH Robust Coefficients"
base.1.fit@fit[['robust.matcoef']]
infocriteria(base.1.fit)

```


Now lets start over and fit an ARMA process to the residuals. I utilize the Box- Jenkins procedure to fit the model. A good specification would have no autocorrelation in the residuals, but autocorrelation in the squared residuals.

The autocorrelation of the residuals is significant, but dies off very slowly. With a max lag of 10, an ARMA(2,3) is the closest we can get to what we want, but it is not perfect at the 5\% level. (3,3) prefers slightly better but the ar3 is not sig. 

```{r soyb_arma1, echo=FALSE}
checkresiduals(x$etf_asset_error)

a <- arima(x$etf_asset_error, c(2,0,3))
Box.test(a$residuals, lag = 10, type = 'Ljung-Box')
Box.test(a$residuals^2, lag = 10, type = 'Ljung-Box')
```

Now let's start over from the beginning with out base GARCH model and see if we should include the unconditional mean. The results are challening as the AIC does improve, but mu is very insignificant. I will leave it out. 

```{r soyb_arma2, echo=FALSE}
base.1.spec <- ugarchspec(variance.model = list(garchOrder = c(1,1)),
                          mean.model = list(armaOrder = c(2,3), include.mean = FALSE))
base.1.fit <- ugarchfit(data = x$etf_asset_error, spec = base.1.spec, solver = 'hybrid')

"No Unconditional Mean Robust Coefficients"
base.1.fit@fit[['robust.matcoef']]
infocriteria(base.1.fit)

base.1.spec <- ugarchspec(variance.model = list(garchOrder = c(1,1)),
                          mean.model = list(armaOrder = c(2,3), include.mean = TRUE))
base.1.fit <- ugarchfit(data = x$etf_asset_error, spec = base.1.spec, solver = 'hybrid')

"Including Unconditional Mean Robust Coefficients"
base.1.fit@fit[['robust.matcoef']]
infocriteria(base.1.fit)

```

Including the ARCHM process leads to model fit problems. 

```{r soyb_arma3, echo = FALSE}
base.1.spec <- ugarchspec(variance.model = list(garchOrder = c(1,1)),
                          mean.model = list(armaOrder = c(2,3), include.mean = FALSE))
base.1.fit <- ugarchfit(data = x$etf_asset_error, spec = base.1.spec, solver = 'hybrid')

"No ARCH in Mean Robust Coefficients"
base.1.fit@fit[['robust.matcoef']]
infocriteria(base.1.fit)


base.1.spec <- ugarchspec(variance.model = list(garchOrder = c(1,1)),
                          mean.model = list(armaOrder = c(2,3), include.mean = FALSE, 
                                            archm = TRUE))
base.1.fit <- ugarchfit(data = x$etf_asset_error, spec = base.1.spec, solver = 'hybrid')

"ARCH in Mean Robust Coefficients"
base.1.fit@fit[['robust.matcoef']]
infocriteria(base.1.fit)
```

Now lets compare normal distribution with student-t. Again we find student-t distribution to have a **much** better fit. 

```{r soyb_arma4, echo=FALSE}
base.1.spec <- ugarchspec(variance.model = list(garchOrder = c(1,1)),
                          mean.model = list(armaOrder = c(2,3), include.mean = FALSE),
                          distribution.model = 'norm')
base.1.fit <- ugarchfit(data = x$etf_asset_error, spec = base.1.spec, solver = 'hybrid')

"Normal Distribution Robust Coefficients"
base.1.fit@fit[['robust.matcoef']]
infocriteria(base.1.fit)

base.1.spec <- ugarchspec(variance.model = list(garchOrder = c(1,1)),
                          mean.model = list(armaOrder = c(2,3), include.mean = FALSE),
                          distribution.model = 'std')
base.1.fit <- ugarchfit(data = x$etf_asset_error, spec = base.1.spec, solver = 'hybrid')

"Student t Distribution Robust Coefficients"
base.1.fit@fit[['robust.matcoef']]
infocriteria(base.1.fit)
```

Now we fit asymmetric models. Unlike CORN, asymmetric models improve model fit. 


```{r soyb_arma5, echo=FALSE}
base.1.spec <- ugarchspec(variance.model = list(garchOrder = c(1,1)),
                          mean.model = list(armaOrder = c(2,3), include.mean = FALSE),
                          distribution.model = 'std')
base.1.fit <- ugarchfit(data = x$etf_asset_error, spec = base.1.spec, solver = 'hybrid')

"Standard GARCH Robust Coefficients"
base.1.fit@fit[['robust.matcoef']]
infocriteria(base.1.fit)



base.1.spec <- ugarchspec(variance.model = list(garchOrder = c(1,1), model = "apARCH"),
                          mean.model = list(armaOrder = c(2,3), include.mean = FALSE),
                          distribution.model = 'std')
base.1.fit <- ugarchfit(data = x$etf_asset_error, spec = base.1.spec, solver = 'hybrid')

"Asymmetric Power GARCH (apGARCH) Robust Coefficients"
base.1.fit@fit[['robust.matcoef']]
infocriteria(base.1.fit)

base.1.spec <- ugarchspec(variance.model = list(garchOrder = c(1,1), model = "gjrGARCH"),
                          mean.model = list(armaOrder = c(2,3), include.mean = FALSE),
                          distribution.model = 'std')
base.1.fit <- ugarchfit(data = x$etf_asset_error, spec = base.1.spec, solver = 'hybrid')

"GJR GARCH Robust Coefficients"
base.1.fit@fit[['robust.matcoef']]
infocriteria(base.1.fit)

base.1.spec <- ugarchspec(variance.model = list(garchOrder = c(1,1), model = "eGARCH"),
                          mean.model = list(armaOrder = c(2,3), include.mean = FALSE),
                          distribution.model = 'std')
base.1.fit <- ugarchfit(data = x$etf_asset_error, spec = base.1.spec, solver = 'hybrid')

"Exponential Power GARCH Robust Coefficients"
base.1.fit@fit[['robust.matcoef']]
infocriteria(base.1.fit)

```


### SOYB Summary
As with CORN, it is likely best to not include ARCH in mean or the unconditional mean in this model specification. Model fit was greatly improved by fitting an ARMA(2,3) process and further greatly improved by using a student-t distribution. Unlike CORN, some of the Asymmetric specifications did have a better fit. 


\newpage

## Wheat

```{r weat_setup, echo = FALSE}
x <- WEAT
```

Lets begin by looking at the OLS results. We fail to reject both of the null hypothesis of $\alpha = 0$. $\beta = 1$

```{r weat_ols, echo = FALSE}
ols <- lm(x$per_ETF_return ~ x$per_asset_return)
summary(ols)
x$etf_asset_error <- ols$residuals
```

There is evidence of ARCH effects in the residuals based off the Ljung-Box Test.

```{r weat_arch, echo = FALSE}
tsdisplay(ols$residuals)

tsdisplay(ols$residuals^2)

Box.test(ols$residuals^2, type = "Ljung-Box")
```

Moving onto GARCH, again including the unconditional mean is unimformative.

```{r weat_1, echo = FALSE}
base.1.spec <- ugarchspec(variance.model = list(garchOrder = c(1,1)),
                          mean.model = list(armaOrder = c(0,0), include.mean = FALSE))
base.1.fit <- ugarchfit(data = x$etf_asset_error, spec = base.1.spec, solver = 'hybrid')

"No unconditional mean Robust Coefficients"
base.1.fit@fit[['robust.matcoef']]
infocriteria(base.1.fit)

base.1.spec <- ugarchspec(variance.model = list(garchOrder = c(1,1)),
                          mean.model = list(armaOrder = c(0,0), include.mean = TRUE))
base.1.fit <- ugarchfit(data = x$etf_asset_error, spec = base.1.spec, solver = 'hybrid')

"Including Unconditional Mean Robust Coefficients"
base.1.fit@fit[['robust.matcoef']]
infocriteria(base.1.fit)
```

The ARCH in mean coefficient is not statistically significant at the 5% level, and including it does not help model fit. For whatever reason, if I try and not include the unconditional mean, the model will not run.

```{r weat_3, echo = FALSE}

base.1.spec <- ugarchspec(variance.model = list(garchOrder = c(1,1)),
                          mean.model = list(armaOrder = c(0,0), include.mean = TRUE, 
                                            archm = TRUE ))
base.1.fit <- ugarchfit(data = x$etf_asset_error, spec = base.1.spec, solver = 'hybrid')

"ARCH in Mean Robust Coefficients"
base.1.fit@fit[['robust.matcoef']]
infocriteria(base.1.fit)

```

As with CORN, lets compare different asymmetric specifications, still assuming a normal distribution. I find not reason to move to an asymmetric model.

```{r weat_4, echo = FALSE}

base.1.spec <- ugarchspec(variance.model = list(garchOrder = c(1,1)),
                          mean.model = list(armaOrder = c(0,0), include.mean = FALSE))
base.1.fit <- ugarchfit(data = x$etf_asset_error, spec = base.1.spec, solver = 'hybrid')

"Standard GARCH Robust Coefficients"
base.1.fit@fit[['robust.matcoef']]
infocriteria(base.1.fit)


base.1.spec <- ugarchspec(variance.model = list(garchOrder = c(1,1), model = "apARCH"),
                          mean.model = list(armaOrder = c(0,0), include.mean = TRUE, 
                                            archm = FALSE ))
base.1.fit <- ugarchfit(data = x$etf_asset_error, spec = base.1.spec, solver = 'hybrid')
"Asymmetric Power ARCH (apARCH) Robust Coefficients"
base.1.fit@fit[['robust.matcoef']]
infocriteria(base.1.fit)


base.1.spec <- ugarchspec(variance.model = list(garchOrder = c(1,1), model = 'gjrGARCH'),
                          mean.model = list(armaOrder = c(0,0), include.mean = TRUE, 
                                            archm = FALSE ))
base.1.fit <- ugarchfit(data = x$etf_asset_error, spec = base.1.spec, solver = 'hybrid')

"GJR ARCH Robust Coefficients"
base.1.fit@fit[['robust.matcoef']]
infocriteria(base.1.fit)


base.1.spec <- ugarchspec(variance.model = list(garchOrder = c(1,1), model = 'eGARCH'),
                          mean.model = list(armaOrder = c(0,0), include.mean = TRUE, 
                                            archm = FALSE ))
base.1.fit <- ugarchfit(data = x$etf_asset_error, spec = base.1.spec, solver = 'hybrid')
"eARCH Robust Coefficients"
base.1.fit@fit[['robust.matcoef']]
infocriteria(base.1.fit)

```

Again, I will replace the normal distribution with the student t distribution. Model fit improves slightly, certainly not as much as the other ETFs

```{r weat_5, echo=FALSE}
base.1.spec <- ugarchspec(variance.model = list(garchOrder = c(1,1), model = 'sGARCH'),
                          mean.model = list(armaOrder = c(0,0), include.mean = FALSE),                                                         distribution.model = 'std')
base.1.fit <- ugarchfit(data = x$etf_asset_error, spec = base.1.spec, solver = 'hybrid')

"Standard GARCH Robust Coefficients"
base.1.fit@fit[['robust.matcoef']]
infocriteria(base.1.fit)


base.1.spec <- ugarchspec(variance.model = list(garchOrder = c(1,1), model = "apARCH"),
                          mean.model = list(armaOrder = c(0,0), include.mean = FALSE, 
                                            archm = FALSE ), distribution.model = 'std')
base.1.fit <- ugarchfit(data = x$etf_asset_error, spec = base.1.spec, solver = 'hybrid')
"Asymmetric Power ARCH (apARCH) Robust Coefficients"
base.1.fit@fit[['robust.matcoef']]
infocriteria(base.1.fit)


base.1.spec <- ugarchspec(variance.model = list(garchOrder = c(1,1), model = "gjrGARCH"),
                          mean.model = list(armaOrder = c(0,0), include.mean = FALSE, 
                                            archm = FALSE ), distribution.model = 'std')
base.1.fit <- ugarchfit(data = x$etf_asset_error, spec = base.1.spec, solver = 'hybrid')

"GJR ARCH Robust Coefficients"
base.1.fit@fit[['robust.matcoef']]
infocriteria(base.1.fit)


base.1.spec <- ugarchspec(variance.model = list(garchOrder = c(1,1), model = "eGARCH"),
                          mean.model = list(armaOrder = c(0,0), include.mean = FALSE, 
                                            archm = FALSE ), distribution.model = 'std')
base.1.fit <- ugarchfit(data = x$etf_asset_error, spec = base.1.spec, solver = 'hybrid')
"eARCH Robust Coefficients"
base.1.fit@fit[['robust.matcoef']]
infocriteria(base.1.fit)

```


Now lets start over and fit an ARMA process to the residuals. I utilize the Box- Jenkins procedure to fit the model. A good specification would have no autocorrelation in the residuals, but autocorrelation in the squared residuals.

(1,5) is the best model specification


```{r weat_arma1, echo=FALSE}
checkresiduals(x$etf_asset_error)

a <- arima(x$etf_asset_error, c(1,0,5))
Box.test(a$residuals, lag = 10, type = 'Ljung-Box')
Box.test(a$residuals^2, lag = 10, type = 'Ljung-Box')
```

Now let's start over from the beginning with out base GARCH model and see if we should include the unconditional mean. The results are challening as the AIC does improve, but mu is very insignificant. I will leave it out. 

```{r weat_arma2, echo=FALSE}
base.1.spec <- ugarchspec(variance.model = list(garchOrder = c(1,1)),
                          mean.model = list(armaOrder = c(1,5), include.mean = FALSE))
base.1.fit <- ugarchfit(data = x$etf_asset_error, spec = base.1.spec, solver = 'hybrid')

"No Unconditional Mean Robust Coefficients"
base.1.fit@fit[['robust.matcoef']]
infocriteria(base.1.fit)

base.1.spec <- ugarchspec(variance.model = list(garchOrder = c(1,1)),
                          mean.model = list(armaOrder = c(1,5), include.mean = TRUE))
base.1.fit <- ugarchfit(data = x$etf_asset_error, spec = base.1.spec, solver = 'hybrid')

"Including Unconditional Mean Robust Coefficients"
base.1.fit@fit[['robust.matcoef']]
infocriteria(base.1.fit)

```

Including the ARCHM process leads to model fit problems. 

```{r weat_arma3, echo = FALSE}
base.1.spec <- ugarchspec(variance.model = list(garchOrder = c(1,1)),
                          mean.model = list(armaOrder = c(1,5), include.mean = FALSE))
base.1.fit <- ugarchfit(data = x$etf_asset_error, spec = base.1.spec, solver = 'hybrid')

"No ARCH in Mean Robust Coefficients"
base.1.fit@fit[['robust.matcoef']]
infocriteria(base.1.fit)


base.1.spec <- ugarchspec(variance.model = list(garchOrder = c(1,1)),
                          mean.model = list(armaOrder = c(1,5), include.mean = FALSE, 
                                            archm = TRUE))
base.1.fit <- ugarchfit(data = x$etf_asset_error, spec = base.1.spec, solver = 'hybrid')

"ARCH in Mean Robust Coefficients"
base.1.fit@fit[['robust.matcoef']]
infocriteria(base.1.fit)
```

Now lets compare normal distribution with student-t. Again we find student-t distribution to have a somewhat better fit. 

```{r weat_arma4, echo=FALSE}
base.1.spec <- ugarchspec(variance.model = list(garchOrder = c(1,1)),
                          mean.model = list(armaOrder = c(1,5), include.mean = FALSE),
                          distribution.model = 'norm')
base.1.fit <- ugarchfit(data = x$etf_asset_error, spec = base.1.spec, solver = 'hybrid')

"Normal Distribution Robust Coefficients"
base.1.fit@fit[['robust.matcoef']]
infocriteria(base.1.fit)

base.1.spec <- ugarchspec(variance.model = list(garchOrder = c(1,1)),
                          mean.model = list(armaOrder = c(1,5), include.mean = FALSE),
                          distribution.model = 'std')
base.1.fit <- ugarchfit(data = x$etf_asset_error, spec = base.1.spec, solver = 'hybrid')

"Student t Distribution Robust Coefficients"
base.1.fit@fit[['robust.matcoef']]
infocriteria(base.1.fit)
```

Now we fit asymmetric models. Like CORN and unlike SOYB, asymmetric models do not help model fit


```{r weat_arma5, echo=FALSE}
base.1.spec <- ugarchspec(variance.model = list(garchOrder = c(1,1)),
                          mean.model = list(armaOrder = c(1,5), include.mean = FALSE),
                          distribution.model = 'std')
base.1.fit <- ugarchfit(data = x$etf_asset_error, spec = base.1.spec, solver = 'hybrid')

"Standard GARCH Robust Coefficients"
base.1.fit@fit[['robust.matcoef']]
infocriteria(base.1.fit)



base.1.spec <- ugarchspec(variance.model = list(garchOrder = c(1,1), model = "apARCH"),
                          mean.model = list(armaOrder = c(1,5), include.mean = FALSE),
                          distribution.model = 'std')
base.1.fit <- ugarchfit(data = x$etf_asset_error, spec = base.1.spec, solver = 'hybrid')

"Asymmetric Power GARCH (apGARCH) Robust Coefficients"
base.1.fit@fit[['robust.matcoef']]
infocriteria(base.1.fit)

base.1.spec <- ugarchspec(variance.model = list(garchOrder = c(1,1), model = "gjrGARCH"),
                          mean.model = list(armaOrder = c(1,5), include.mean = FALSE),
                          distribution.model = 'std')
base.1.fit <- ugarchfit(data = x$etf_asset_error, spec = base.1.spec, solver = 'hybrid')

"GJR GARCH Robust Coefficients"
base.1.fit@fit[['robust.matcoef']]
infocriteria(base.1.fit)

base.1.spec <- ugarchspec(variance.model = list(garchOrder = c(1,1), model = "eGARCH"),
                          mean.model = list(armaOrder = c(1,5), include.mean = FALSE),
                          distribution.model = 'std')
base.1.fit <- ugarchfit(data = x$etf_asset_error, spec = base.1.spec, solver = 'hybrid')

"Exponential Power GARCH Robust Coefficients"
base.1.fit@fit[['robust.matcoef']]
infocriteria(base.1.fit)

```


### WEAT Summary
As with CORN and SOYB, it is likely best to not include ARCH in mean or the unconditional mean in this model specification as it does not improve model fit or produce significant coefficients. Fitting an ARMA (1,5) process also improved fit significantly.  Changing from a normal distribution to a student t distribution *slightly* improved model fit. Asymmetric models did not have better fit. 