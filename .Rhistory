install.packages('minitex')
setwd("~/Documents/etf_tracking")
knitr::opts_chunk$set(echo = TRUE)
library(tseries)
library(tseries)
library(xts)
library(fpp2)
library(fpp2)
library(stats)
library(rugarch)
library(fpp2)
library(stats)
library(rugarch)
setwd("~/Documents/etf_tracking")
#-----------------Import Data from Excel and order------------#
CORN <- read.csv("~/Documents/etf_tracking/corn.csv")
View(CORN)
type(CORN$F1..35.)
typeof(CORN$F1..35.)
typeof(CORN$DATE)
typeof(CORN$C.Mar)
#-----------------Import Data from Excel and order------------#
CORN <- read.csv("~/Documents/etf_tracking/corn.csv")
SOYB <- read.csv("~/Documents/etf_tracking/soyb.csv")
WEAT <- read.csv("~/Documents/etf_tracking/weat.csv")
USO <- read.csv("~/Documents/etf_tracking/uso.csv")
UGA <- read.csv("~/Documents/etf_tracking/uga.csv")
View(UGA)
View(CORN)
View(SOYB)
View(USO)
typeof(USO$CL.Day.Before.Roll)
View(WEAT)
#------------------Date Manipulation and Cleaning---------------#
CORN$DATE <- as.Date(CORN$DATE)  #set date
View(CORN)
#------------------Date Manipulation and Cleaning---------------#
CORN$DATE <- as.Date(CORN$DATE, format = "%m/%d/%y")  #set date
typeof(CORN$DATE)
View(CORN)
#------------------Date Manipulation and Cleaning---------------#
CORN$DATE <- as.Date(CORN$DATE, format = "%m/%d/%y")  #set date
CORN$DATE <- as.Date(CORN$DATE, format = "%m/%d/%y")  #set date
View(CORN)
typeof(CORN$DATE)
CORN <- CORN[order(CORN$DATE),] #order by date
#------------------Date Manipulation and Cleaning---------------#
CORN$DATE <- as.Date(CORN$DATE, format = "%m/%d/%Y")  #set date
typeof(CORN$DATE)
CORN <- CORN[order(CORN$DATE),] #order by date
#-----------------Import Data from Excel and order------------#
CORN <- read.csv("~/Documents/etf_tracking/corn.csv")
SOYB <- read.csv("~/Documents/etf_tracking/soyb.csv")
WEAT <- read.csv("~/Documents/etf_tracking/weat.csv")
USO <- read.csv("~/Documents/etf_tracking/uso.csv")
UGA <- read.csv("~/Documents/etf_tracking/uga.csv")
#------------------Date Manipulation and Cleaning---------------#
CORN$DATE <- as.Date(CORN$DATE, format = "%m/%d/%Y")  #set date
CORN <- CORN[order(CORN$DATE),] #order by date
#-----------------Import Data from Excel and order------------#
CORN <- read.csv("~/Documents/etf_tracking/corn.csv")
SOYB <- read.csv("~/Documents/etf_tracking/soyb.csv")
WEAT <- read.csv("~/Documents/etf_tracking/weat.csv")
USO <- read.csv("~/Documents/etf_tracking/uso.csv")
UGA <- read.csv("~/Documents/etf_tracking/uga.csv")
#------------------Date Manipulation and Cleaning---------------#
CORN$DATE <- as.Date(CORN$DATE, format = "%m/%d/%Y")  #set date
CORN <- CORN[order(CORN$DATE),] #order by date
CORN$asset_basket <- (CORN$`F1(.35)` * 0.35) + (CORN$`F2(.3)` * 0.3) + (CORN$`F3(.35)` * 0.35) #reconstruct asset basket
CORN$per_asset_return <- log(CORN$asset_basket/lag(CORN$asset_basket))* 100 # calculate percent asset basket return
CORN$asset_basket <- (CORN$`F1(.35)` * 0.35) + (CORN$`F2(.3)` * 0.3) + (CORN$`F3(.35)` * 0.35) #reconstruct asset basket
View(CORN)
#------------------Date Manipulation and Cleaning---------------#
CORN$DATE <- as.Date(CORN$DATE, format = "%m/%d/%Y")  #set date
CORN <- CORN[order(CORN$DATE),] #order by date
CORN$asset_basket <- (CORN$`F1..35.` * 0.35) + (CORN$`F2..3.` * 0.3) + (CORN$`F3..35.` * 0.35) #reconstruct asset basket
CORN$per_asset_return <- log(CORN$asset_basket/lag(CORN$asset_basket))* 100 # calculate percent asset basket return
CORN$per_ETF_return <- log(CORN$CORN_MID/lag(CORN$CORN_MID)) * 100#calculate percent ETF return
SOYB$DATE <- as.Date(SOYB$DATE, format = "%m/%d/%Y") # Set date
SOYB$per_asset_return <- log(SOYB$asset_basket / lag(SOYB$asset_basket)) * 100
SOYB$per_ETF_return <- log(SOYB$SOYB_MID / lag(SOYB$SOYB_MID)) * 100
WEAT$DATE <- as.Date(WEAT$DATE, format = "%m/%d/%Y") #set date
SOYB$asset_basket <- (SOYB$`F1..35.` * 0.35) + (SOYB$`F2..3.` * 0.30) + (SOYB$`F3..35.` * 0.35)
SOYB$per_asset_return <- log(SOYB$asset_basket / lag(SOYB$asset_basket)) * 100
SOYB <- SOYB[order(SOYB$DATE),] #order by date
SOYB$asset_basket <- (SOYB$`F1..35.` * 0.35) + (SOYB$`F2..3.` * 0.30) + (SOYB$`F3..35.` * 0.35)
SOYB$per_asset_return <- log(SOYB$asset_basket / lag(SOYB$asset_basket)) * 100
SOYB$per_ETF_return <- log(SOYB$SOYB_MID / lag(SOYB$SOYB_MID)) * 100
WEAT$DATE <- as.Date(WEAT$DATE, format = "%m/%d/%Y") #set date
WEAT <- WEAT[order(WEAT$DATE),] #order by date
WEAT$asset_basket <- (WEAT$`F1..35.` * 0.35) + (WEAT$`F2..3.` * 0.3) + (WEAT$`F3..35.` * 0.35) #reconstruct asset basket
WEAT$per_asset_return <- log(WEAT$asset_basket/lag(WEAT$asset_basket))* 100 # calculate percent asset basket return
WEAT$per_ETF_return <- log(WEAT$WEAT_MID/lag(WEAT$WEAT_MID)) * 100#calculate percent ETF return
USO$DATE <- as.Date(USO$DATE, format = "%m/%d/%Y")
USO <- USO[order(USO$DATE),]
USO$per_asset_return <- log(USO$Futures/lag(USO$Futures)) * 100
USO$per_ETF_return <- log(USO$USO_MID /lag(USO$USO_MID)) * 100
UGA$DATE <- as.Date(UGA$DATE, format = "%m/%d/%Y")
UGA <- UGA[order(UGA$DATE),]
UGA$per_asset_return <- log(UGA$Futures/lag(UGA$Futures)) * 100
UGA$per_ETF_return <- log(UGA$UGA_MID/lag(UGA$UGA_MID)) * 100
#  Volume data ------------------------------------------------------------------------
volume <- read.csv("~/Documents/etf_tracking/Volume.csv")
# subset the dataframe to only the relevant columes
corn.volume <- data.frame(as.Date(volume$DATE), volume$CORN.Volume)
#rename the columns
colnames(corn.volume) <- c("DATE", "Volume")
#Merge the Volume data with the other data
CORN <- merge(CORN, corn.volume, by = "DATE")
# calculate percent change in volume
CORN$volume_return <-log(CORN$Volume/lag(CORN$Volume)) * 100
soyb.volume <- data.frame(as.Date(volume$DATE), volume$SOYB.Volume)
colnames(soyb.volume) <- c("DATE", "Volume")
SOYB <- merge(SOYB, soyb.volume, by = "DATE")
SOYB$volume_return <-log(SOYB$Volume/lag(SOYB$Volume)) * 100
weat.volume <- data.frame(as.Date(volume$DATE), volume$WEAT.Volume)
colnames(weat.volume) <- c("DATE", "Volume")
WEAT <- merge(WEAT, weat.volume, by = "DATE")
WEAT$volume_return <-log(WEAT$Volume/lag(WEAT$Volume)) * 100
uso.volume <- data.frame(as.Date(volume$DATE), volume$USO.Volume)
colnames(uso.volume) <- c("DATE", "Volume")
USO <- merge(USO, uso.volume, by = "DATE")
USO$volume_return <-log(USO$Volume/lag(USO$Volume)) * 100
uga.volume <- data.frame(as.Date(volume$DATE), volume$UGA.Volume)
colnames(uga.volume) <- c("DATE", "Volume")
UGA <- merge(UGA, uga.volume, by = "DATE")
UGA$volume_return <-log(UGA$Volume/lag(UGA$Volume)) * 100
#--- More data cleaning
# The code below handles the issue of roll dates
CORN <- na.omit(CORN)
CORN <- CORN[!(CORN$ROLL == 1),] #directly remove roll
CORN.xts <- xts(CORN[,-1], order.by = CORN$DATE)
#--- More data cleaning
# The code below handles the issue of roll dates
CORN <- na.omit(CORN)
CORN <- CORN[!(CORN$ROLL == 1),] #directly remove roll
CORN.xts <- xts(CORN[,-1], order.by = CORN$DATE)
SOYB <- na.omit(SOYB)
SOYB <- SOYB[!(SOYB$ROLL == 1),]
SOYB.xts <- xts(SOYB[,-1], order.by = SOYB$DATE) #create xts object
WEAT <- na.omit(WEAT)
WEAT <- WEAT[!(WEAT$ROLL == 1),]
WEAT.xts <- xts(WEAT[,-1], order.by = WEAT$DATE)
USO <- na.omit(USO)
USO <- USO[!(USO$ROLL == 1),]
USO.xts <- as.xts(USO, order.by = USO$DATE)
UGA <- na.omit(UGA)
UGA <- UGA[!(UGA$ROLL == 1),]
UGA.xts <- xts(UGA[,-1], order.by = UGA$DATE)
View(UGA.xts)
View(UGA)
#-----------------Import Data from Excel and order------------#
CORN <- read.csv("~/Documents/etf_tracking/corn.csv")
SOYB <- read.csv("~/Documents/etf_tracking/soyb.csv")
WEAT <- read.csv("~/Documents/etf_tracking/weat.csv")
USO <- read.csv("~/Documents/etf_tracking/uso.csv")
UGA <- read.csv("~/Documents/etf_tracking/uga.csv")
#------------------Date Manipulation and Cleaning---------------#
CORN$DATE <- as.Date(CORN$DATE, format = "%m/%d/%Y")  #set date
CORN <- CORN[order(CORN$DATE),] #order by date
CORN$asset_basket <- (CORN$`F1..35.` * 0.35) + (CORN$`F2..3.` * 0.3) + (CORN$`F3..35.` * 0.35) #reconstruct asset basket
CORN$per_asset_return <- log(CORN$asset_basket/lag(CORN$asset_basket))* 100 # calculate percent asset basket return
CORN$per_ETF_return <- log(CORN$CORN_MID/lag(CORN$CORN_MID)) * 100#calculate percent ETF return
SOYB$DATE <- as.Date(SOYB$DATE, format = "%m/%d/%Y") # Set date
SOYB <- SOYB[order(SOYB$DATE),] #order by date
#-----------------Import Data from Excel and order------------#
CORN <- read.csv("~/Documents/etf_tracking/corn.csv")
SOYB <- read.csv("~/Documents/etf_tracking/soyb.csv")
WEAT <- read.csv("~/Documents/etf_tracking/weat.csv")
USO <- read.csv("~/Documents/etf_tracking/uso.csv")
UGA <- read.csv("~/Documents/etf_tracking/uga.csv")
#------------------Date Manipulation and Cleaning---------------#
CORN$DATE <- as.Date(CORN$DATE, format = "%m/%d/%Y")  #set date
CORN <- CORN[order(CORN$DATE),] #order by date
CORN$asset_basket <- (CORN$`F1..35.` * 0.35) + (CORN$`F2..3.` * 0.3) + (CORN$`F3..35.` * 0.35) #reconstruct asset basket
CORN$per_asset_return <- log(CORN$asset_basket/lag(CORN$asset_basket))* 100 # calculate percent asset basket return
CORN$per_ETF_return <- log(CORN$CORN_MID/lag(CORN$CORN_MID)) * 100#calculate percent ETF return
SOYB$DATE <- as.Date(SOYB$DATE, format = "%m/%d/%Y") # Set date
SOYB <- SOYB[order(SOYB$DATE),] #order by date
SOYB$asset_basket <- (SOYB$`F1..35.` * 0.35) + (SOYB$`F2..3.` * 0.30) + (SOYB$`F3..35.` * 0.35)
SOYB$per_asset_return <- log(SOYB$asset_basket / lag(SOYB$asset_basket)) * 100
SOYB$per_ETF_return <- log(SOYB$SOYB_MID / lag(SOYB$SOYB_MID)) * 100
WEAT$DATE <- as.Date(WEAT$DATE, format = "%m/%d/%Y") #set date
WEAT <- WEAT[order(WEAT$DATE),] #order by date
WEAT$asset_basket <- (WEAT$`F1..35.` * 0.35) + (WEAT$`F2..3.` * 0.3) + (WEAT$`F3..35.` * 0.35) #reconstruct asset basket
WEAT$per_asset_return <- log(WEAT$asset_basket/lag(WEAT$asset_basket))* 100 # calculate percent asset basket return
WEAT$per_ETF_return <- log(WEAT$WEAT_MID/lag(WEAT$WEAT_MID)) * 100#calculate percent ETF return
USO$DATE <- as.Date(USO$DATE, format = "%m/%d/%Y")
USO <- USO[order(USO$DATE),]
USO$per_asset_return <- log(USO$Futures/lag(USO$Futures)) * 100
USO$per_ETF_return <- log(USO$USO_MID /lag(USO$USO_MID)) * 100
UGA$DATE <- as.Date(UGA$DATE, format = "%m/%d/%Y")
UGA <- UGA[order(UGA$DATE),]
UGA$per_asset_return <- log(UGA$Futures/lag(UGA$Futures)) * 100
UGA$per_ETF_return <- log(UGA$UGA_MID/lag(UGA$UGA_MID)) * 100
#--- More data cleaning
# The code below handles the issue of roll dates
CORN <- na.omit(CORN)
CORN <- CORN[!(CORN$ROLL == 1),] #directly remove roll
CORN.xts <- xts(CORN[,-1], order.by = CORN$DATE)
SOYB <- na.omit(SOYB)
SOYB <- SOYB[!(SOYB$ROLL == 1),]
SOYB.xts <- xts(SOYB[,-1], order.by = SOYB$DATE) #create xts object
WEAT <- na.omit(WEAT)
WEAT <- WEAT[!(WEAT$ROLL == 1),]
WEAT.xts <- xts(WEAT[,-1], order.by = WEAT$DATE)
USO <- na.omit(USO)
USO <- USO[!(USO$ROLL == 1),]
USO.xts <- as.xts(USO, order.by = USO$DATE)
UGA <- na.omit(UGA)
UGA <- UGA[!(UGA$ROLL == 1),]
UGA.xts <- xts(UGA[,-1], order.by = UGA$DATE)
#-----------------Import Data from Excel and order------------#
CORN <- read.csv("~/Documents/etf_tracking/corn.csv")
SOYB <- read.csv("~/Documents/etf_tracking/soyb.csv")
WEAT <- read.csv("~/Documents/etf_tracking/weat.csv")
USO <- read.csv("~/Documents/etf_tracking/uso.csv")
UGA <- read.csv("~/Documents/etf_tracking/uga.csv")
#------------------Date Manipulation and Cleaning---------------#
CORN$DATE <- as.Date(CORN$DATE, format = "%m/%d/%Y")  #set date
CORN <- CORN[order(CORN$DATE),] #order by date
CORN$asset_basket <- (CORN$`F1..35.` * 0.35) + (CORN$`F2..3.` * 0.3) + (CORN$`F3..35.` * 0.35) #reconstruct asset basket
CORN$per_asset_return <- log(CORN$asset_basket/lag(CORN$asset_basket))* 100 # calculate percent asset basket return
CORN$per_ETF_return <- log(CORN$CORN_MID/lag(CORN$CORN_MID)) * 100#calculate percent ETF return
SOYB$DATE <- as.Date(SOYB$DATE, format = "%m/%d/%Y") # Set date
SOYB <- SOYB[order(SOYB$DATE),] #order by date
SOYB$asset_basket <- (SOYB$`F1..35.` * 0.35) + (SOYB$`F2..3.` * 0.30) + (SOYB$`F3..35.` * 0.35)
SOYB$per_asset_return <- log(SOYB$asset_basket / lag(SOYB$asset_basket)) * 100
SOYB$per_ETF_return <- log(SOYB$SOYB_MID / lag(SOYB$SOYB_MID)) * 100
WEAT$DATE <- as.Date(WEAT$DATE, format = "%m/%d/%Y") #set date
WEAT <- WEAT[order(WEAT$DATE),] #order by date
WEAT$asset_basket <- (WEAT$`F1..35.` * 0.35) + (WEAT$`F2..3.` * 0.3) + (WEAT$`F3..35.` * 0.35) #reconstruct asset basket
WEAT$per_asset_return <- log(WEAT$asset_basket/lag(WEAT$asset_basket))* 100 # calculate percent asset basket return
WEAT$per_ETF_return <- log(WEAT$WEAT_MID/lag(WEAT$WEAT_MID)) * 100#calculate percent ETF return
USO$DATE <- as.Date(USO$DATE, format = "%m/%d/%Y")
USO <- USO[order(USO$DATE),]
USO$per_asset_return <- log(USO$Futures/lag(USO$Futures)) * 100
USO$per_ETF_return <- log(USO$USO_MID /lag(USO$USO_MID)) * 100
UGA$DATE <- as.Date(UGA$DATE, format = "%m/%d/%Y")
UGA <- UGA[order(UGA$DATE),]
UGA$per_asset_return <- log(UGA$Futures/lag(UGA$Futures)) * 100
UGA$per_ETF_return <- log(UGA$UGA_MID/lag(UGA$UGA_MID)) * 100
#--- More data cleaning
# The code below handles the issue of roll dates
CORN <- na.omit(CORN)
View(SOYB)
View(UGA)
#-----------------Import Data from Excel and order------------#
CORN <- read.csv("~/Documents/etf_tracking/corn.csv")
# When importing data from csv, for some reason empty columns are created
CORN <- CORN[,-2]
View(CORN)
# When importing data from csv, for some reason empty columns are created
CORN <- CORN[,-2]
# When importing data from csv, for some reason empty columns are created
CORN <- CORN[,-2]
View(CORN)
#-----------------Import Data from Excel and order------------#
CORN <- read.csv("~/Documents/etf_tracking/corn.csv")
# When importing data from csv, for some reason empty columns are created
CORN <- CORN[1:(length(CORN)-2)]
#-----------------Import Data from Excel and order------------#
CORN <- read.csv("~/Documents/etf_tracking/corn.csv")
SOYB <- read.csv("~/Documents/etf_tracking/soyb.csv")
WEAT <- read.csv("~/Documents/etf_tracking/weat.csv")
USO <- read.csv("~/Documents/etf_tracking/uso.csv")
UGA <- read.csv("~/Documents/etf_tracking/uga.csv")
# When importing data from csv, for some reason empty columns are created
CORN <- CORN[1:(length(CORN)-2)]
View(SOYB)
View(WEAT)
View(SOYB)
View(USO)
View(UGA)
#-----------------Import Data from Excel and order------------#
CORN <- read.csv("~/Documents/etf_tracking/corn.csv")
SOYB <- read.csv("~/Documents/etf_tracking/soyb.csv")
WEAT <- read.csv("~/Documents/etf_tracking/weat.csv")
USO <- read.csv("~/Documents/etf_tracking/uso.csv")
UGA <- read.csv("~/Documents/etf_tracking/uga.csv")
#------------------Date Manipulation and Cleaning---------------#
# When importing data from csv, for some reason empty columns are created
# This is only a temporary solution to this problem
CORN <- CORN[1:(length(CORN)-2)]
SOYB <- SOYB[1:(length(SOYB)-1)]
WEAT <- WEAT[1:(length(WEAT)-2)]
# USO Good
UGA <- UGA[1:(length(UGA)-1)]
CORN$DATE <- as.Date(CORN$DATE, format = "%m/%d/%Y")  #set date
CORN <- CORN[order(CORN$DATE),] #order by date
CORN$asset_basket <- (CORN$`F1..35.` * 0.35) + (CORN$`F2..3.` * 0.3) + (CORN$`F3..35.` * 0.35) #reconstruct asset basket
CORN$per_asset_return <- log(CORN$asset_basket/lag(CORN$asset_basket))* 100 # calculate percent asset basket return
CORN$per_ETF_return <- log(CORN$CORN_MID/lag(CORN$CORN_MID)) * 100#calculate percent ETF return
SOYB$DATE <- as.Date(SOYB$DATE, format = "%m/%d/%Y") # Set date
SOYB <- SOYB[order(SOYB$DATE),] #order by date
SOYB$asset_basket <- (SOYB$`F1..35.` * 0.35) + (SOYB$`F2..3.` * 0.30) + (SOYB$`F3..35.` * 0.35)
SOYB$per_asset_return <- log(SOYB$asset_basket / lag(SOYB$asset_basket)) * 100
SOYB$per_ETF_return <- log(SOYB$SOYB_MID / lag(SOYB$SOYB_MID)) * 100
WEAT$DATE <- as.Date(WEAT$DATE, format = "%m/%d/%Y") #set date
WEAT <- WEAT[order(WEAT$DATE),] #order by date
WEAT$asset_basket <- (WEAT$`F1..35.` * 0.35) + (WEAT$`F2..3.` * 0.3) + (WEAT$`F3..35.` * 0.35) #reconstruct asset basket
WEAT$per_asset_return <- log(WEAT$asset_basket/lag(WEAT$asset_basket))* 100 # calculate percent asset basket return
WEAT$per_ETF_return <- log(WEAT$WEAT_MID/lag(WEAT$WEAT_MID)) * 100#calculate percent ETF return
USO$DATE <- as.Date(USO$DATE, format = "%m/%d/%Y")
USO <- USO[order(USO$DATE),]
USO$per_asset_return <- log(USO$Futures/lag(USO$Futures)) * 100
USO$per_ETF_return <- log(USO$USO_MID /lag(USO$USO_MID)) * 100
UGA$DATE <- as.Date(UGA$DATE, format = "%m/%d/%Y")
UGA <- UGA[order(UGA$DATE),]
UGA$per_asset_return <- log(UGA$Futures/lag(UGA$Futures)) * 100
UGA$per_ETF_return <- log(UGA$UGA_MID/lag(UGA$UGA_MID)) * 100
#--- More data cleaning
# The code below handles the issue of roll dates
CORN <- na.omit(CORN)
CORN <- CORN[!(CORN$ROLL == 1),] #directly remove roll
CORN.xts <- xts(CORN[,-1], order.by = CORN$DATE)
SOYB <- na.omit(SOYB)
SOYB <- SOYB[!(SOYB$ROLL == 1),]
SOYB.xts <- xts(SOYB[,-1], order.by = SOYB$DATE) #create xts object
WEAT <- na.omit(WEAT)
WEAT <- WEAT[!(WEAT$ROLL == 1),]
WEAT.xts <- xts(WEAT[,-1], order.by = WEAT$DATE)
USO <- na.omit(USO)
USO <- USO[!(USO$ROLL == 1),]
USO.xts <- as.xts(USO, order.by = USO$DATE)
UGA <- na.omit(UGA)
UGA <- UGA[!(UGA$ROLL == 1),]
UGA.xts <- xts(UGA[,-1], order.by = UGA$DATE)
View(CORN.xts)
View(SOYB.xts)
x <- CORN
x <- CORN
Lets begin by looking at the OLS results for CORN. We would reject both of our null hypothesis ($\alpha = 0$ and $\beta = 1$)
```{r corn_ols, echo = FALSE}
ols <- lm(x$per_ETF_return ~ x$per_asset_return)
summary(ols)
x$etf_asset_error <- ols$residuals
ols <- lm(x$per_ETF_return ~ x$per_asset_return)
summary(ols)
x$etf_asset_error <- ols$residuals
Now we investigate the residuals. There is clearly evidence of ARCH effects in the residuals based off the Ljung-Box Test.
```{r corn_arch, echo = FALSE}
tsdisplay(ols$residuals)
tsdisplay(ols$residuals)
tsdisplay(ols$residuals^2)
Box.test(ols$residuals^2, type = "Ljung-Box")
checkresiduals(x$etf_asset_error)
library(tseries)
library(xts)
library(tidyverse)
library(tidyverse)
library(fpp2)
library(stats)
library(rugarch)
setwd("~/Documents/etf_tracking")
#-----------------Import Data from Excel and order------------#
CORN <- read.csv("~/Documents/etf_tracking/corn.csv")
SOYB <- read.csv("~/Documents/etf_tracking/soyb.csv")
WEAT <- read.csv("~/Documents/etf_tracking/weat.csv")
USO <- read.csv("~/Documents/etf_tracking/uso.csv")
UGA <- read.csv("~/Documents/etf_tracking/uga.csv")
#------------------Date Manipulation and Cleaning---------------#
# When importing data from csv, for some reason empty columns are created
# This is only a temporary solution to this problem
CORN <- CORN[1:(length(CORN)-2)]
SOYB <- SOYB[1:(length(SOYB)-1)]
WEAT <- WEAT[1:(length(WEAT)-2)]
# USO Good
UGA <- UGA[1:(length(UGA)-1)]
CORN$DATE <- as.Date(CORN$DATE, format = "%m/%d/%Y")  #set date
CORN <- CORN[order(CORN$DATE),] #order by date
CORN$asset_basket <- (CORN$`F1..35.` * 0.35) + (CORN$`F2..3.` * 0.3) + (CORN$`F3..35.` * 0.35) #reconstruct asset basket
CORN$per_asset_return <- log(CORN$asset_basket/lag(CORN$asset_basket))* 100 # calculate percent asset basket return
CORN$per_ETF_return <- log(CORN$CORN_MID/lag(CORN$CORN_MID)) * 100#calculate percent ETF return
SOYB$DATE <- as.Date(SOYB$DATE, format = "%m/%d/%Y") # Set date
SOYB <- SOYB[order(SOYB$DATE),] #order by date
SOYB$asset_basket <- (SOYB$`F1..35.` * 0.35) + (SOYB$`F2..3.` * 0.30) + (SOYB$`F3..35.` * 0.35)
SOYB$per_asset_return <- log(SOYB$asset_basket / lag(SOYB$asset_basket)) * 100
SOYB$per_ETF_return <- log(SOYB$SOYB_MID / lag(SOYB$SOYB_MID)) * 100
WEAT$DATE <- as.Date(WEAT$DATE, format = "%m/%d/%Y") #set date
WEAT <- WEAT[order(WEAT$DATE),] #order by date
WEAT$asset_basket <- (WEAT$`F1..35.` * 0.35) + (WEAT$`F2..3.` * 0.3) + (WEAT$`F3..35.` * 0.35) #reconstruct asset basket
WEAT$per_asset_return <- log(WEAT$asset_basket/lag(WEAT$asset_basket))* 100 # calculate percent asset basket return
WEAT$per_ETF_return <- log(WEAT$WEAT_MID/lag(WEAT$WEAT_MID)) * 100#calculate percent ETF return
USO$DATE <- as.Date(USO$DATE, format = "%m/%d/%Y")
USO <- USO[order(USO$DATE),]
USO$per_asset_return <- log(USO$Futures/lag(USO$Futures)) * 100
USO$per_ETF_return <- log(USO$USO_MID /lag(USO$USO_MID)) * 100
UGA$DATE <- as.Date(UGA$DATE, format = "%m/%d/%Y")
UGA <- UGA[order(UGA$DATE),]
UGA$per_asset_return <- log(UGA$Futures/lag(UGA$Futures)) * 100
UGA$per_ETF_return <- log(UGA$UGA_MID/lag(UGA$UGA_MID)) * 100
#--- More data cleaning
# The code below handles the issue of roll dates
CORN <- na.omit(CORN)
CORN <- CORN[!(CORN$ROLL == 1),] #directly remove roll
CORN.xts <- xts(CORN[,-1], order.by = CORN$DATE)
SOYB <- na.omit(SOYB)
SOYB <- SOYB[!(SOYB$ROLL == 1),]
SOYB.xts <- xts(SOYB[,-1], order.by = SOYB$DATE) #create xts object
WEAT <- na.omit(WEAT)
WEAT <- WEAT[!(WEAT$ROLL == 1),]
WEAT.xts <- xts(WEAT[,-1], order.by = WEAT$DATE)
USO <- na.omit(USO)
USO <- USO[!(USO$ROLL == 1),]
USO.xts <- as.xts(USO, order.by = USO$DATE)
UGA <- na.omit(UGA)
UGA <- UGA[!(UGA$ROLL == 1),]
UGA.xts <- xts(UGA[,-1], order.by = UGA$DATE)
x <- SOYB
x <- SOYB
Lets begin by looking at the OLS results for soybeans. Unlike CORN, we fail to reject both of our null hypothesis ($\alpha = 0$ and $\beta = 1$).
```{r soyb_ols, echo = FALSE}
ols <- lm(x$per_ETF_return ~ x$per_asset_return)
summary(ols)
x$etf_asset_error <- ols$residuals
checkresiduals(x$etf_asset_error)
a <- arima(x$etf_asset_error, c(0,0,1))
Box.test(a$residuals, lag = 10, type = 'Ljung-Box')
Box.test(a$residuals^2, lag = 10, type = 'Ljung-Box')
a <- arima(x$etf_asset_error, c(1,0,1))
Box.test(a$residuals, lag = 10, type = 'Ljung-Box')
a <- arima(x$etf_asset_error, c(2,0,1))
Box.test(a$residuals, lag = 10, type = 'Ljung-Box')
a <- arima(x$etf_asset_error, c(2,0,2))
Box.test(a$residuals, lag = 10, type = 'Ljung-Box')
a <- arima(x$etf_asset_error, c(4,0,3))
Box.test(a$residuals, lag = 10, type = 'Ljung-Box')
a <- arima(x$etf_asset_error, c(3,0,3))
Box.test(a$residuals, lag = 10, type = 'Ljung-Box')
a <- arima(x$etf_asset_error, c(3,0,4))
a <- arima(x$etf_asset_error, c(3,0,4))
Box.test(a$residuals, lag = 10, type = 'Ljung-Box')
a <- arima(x$etf_asset_error, c(3,0,2))
Box.test(a$residuals, lag = 10, type = 'Ljung-Box')
a <- arima(x$etf_asset_error, c(3,0,3))
Box.test(a$residuals, lag = 10, type = 'Ljung-Box')
a <- arima(x$etf_asset_error, c(5,0,3))
Box.test(a$residuals, lag = 10, type = 'Ljung-Box')
a <- arima(x$etf_asset_error, c(5,0,5))
Box.test(a$residuals, lag = 10, type = 'Ljung-Box')
a <- arima(x$etf_asset_error, c(5,0,5))
a <- arima(x$etf_asset_error, c(4,0,4))
Box.test(a$residuals, lag = 10, type = 'Ljung-Box')
Box.test(a$residuals^2, lag = 10, type = 'Ljung-Box')
a <- arima(x$etf_asset_error, c(3,0,3))
Box.test(a$residuals, lag = 10, type = 'Ljung-Box')
Box.test(a$residuals^2, lag = 10, type = 'Ljung-Box')
a <- arima(x$etf_asset_error, c(2,0,3))
Box.test(a$residuals, lag = 10, type = 'Ljung-Box')
a <- arima(x$etf_asset_error, c(1,0,1))
Box.test(a$residuals, lag = 10, type = 'Ljung-Box')
a <- arima(x$etf_asset_error, c(2,0,1))
Box.test(a$residuals, lag = 10, type = 'Ljung-Box')
a <- arima(x$etf_asset_error, c(2,0,3))
Box.test(a$residuals, lag = 10, type = 'Ljung-Box')
a <- arima(x$etf_asset_error, c(3,0,3))
Box.test(a$residuals, lag = 10, type = 'Ljung-Box')
a <- arima(x$etf_asset_error, c(4,0,3))
Box.test(a$residuals, lag = 10, type = 'Ljung-Box')
checkresiduals(x$etf_asset_error)
x <- WEAT
checkresiduals(x$etf_asset_error)
a <- arima(x$etf_asset_error, c(4,0,3))
checkresiduals(x$etf_asset_error)
View(WEAT)
ols <- lm(x$per_ETF_return ~ x$per_asset_return)
summary(ols)
x$etf_asset_error <- ols$residuals
tsdisplay(ols$residuals)
checkresiduals(x$etf_asset_error)
a <- arima(x$etf_asset_error, c(4,0,3))
Box.test(a$residuals, lag = 10, type = 'Ljung-Box')
a <- arima(x$etf_asset_error, c(2,0,2))
Box.test(a$residuals, lag = 10, type = 'Ljung-Box')
a <- arima(x$etf_asset_error, c(1,0,2))
Box.test(a$residuals, lag = 10, type = 'Ljung-Box')
a <- arima(x$etf_asset_error, c(1,0,1))
Box.test(a$residuals, lag = 10, type = 'Ljung-Box')
a <- arima(x$etf_asset_error, c(1,0,0))
Box.test(a$residuals, lag = 10, type = 'Ljung-Box')
a <- arima(x$etf_asset_error, c(1,0,3))
Box.test(a$residuals, lag = 10, type = 'Ljung-Box')
a <- arima(x$etf_asset_error, c(1,0,5))
Box.test(a$residuals, lag = 10, type = 'Ljung-Box')
a <- arima(x$etf_asset_error, c(1,0,4))
Box.test(a$residuals, lag = 10, type = 'Ljung-Box')
a <- arima(x$etf_asset_error, c(1,0,5))
Box.test(a$residuals, lag = 10, type = 'Ljung-Box')
a <- arima(x$etf_asset_error, c(2,0,5))
Box.test(a$residuals, lag = 10, type = 'Ljung-Box')
a <- arima(x$etf_asset_error, c(1,0,5))
Box.test(a$residuals, lag = 10, type = 'Ljung-Box')
Box.test(a$residuals, lag = 10, type = 'Ljung-Box')
Box.test(a$residuals^2, lag = 10, type = 'Ljung-Box')
auto.arima(x$etf_asset_error)
